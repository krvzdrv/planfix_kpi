# Исправления в отчете о доходах (PRZYCHODY)

## Проблема
В отчете о доходах неправильно рассчитывался показатель `brak` (недостача). Вместо правильного расчета `brak = Plan - Fakt - Dlug`, отчет брал сумму **ВСЕХ** заказов из базы данных.

## Причина
В коммите `3de3259` (18 июня 2025) был добавлен неправильный SQL-запрос для `brak`:

```sql
# Получаем все заказы (brak)
cur.execute("""
    SELECT 
        menedzher,
        SUM(CAST(REPLACE(wartosc_netto_pln, ',', '.') AS DECIMAL)) as brak
    FROM planfix_orders
    WHERE 
        is_deleted = false
    GROUP BY menedzher
""")
```

Этот запрос суммировал **все** заказы без учета их статуса или даты, что приводило к неправильным результатам.

## Исправление
Убран неправильный SQL-запрос для `brak`. Теперь `brak` рассчитывается правильно как:

```python
brak = max(Decimal('0'), revenue_plan - fakt - dlug)
```

## Что исправлено
1. ✅ Убран неправильный SQL-запрос для `brak`
2. ✅ Восстановлен правильный расчет: `brak = Plan - Fakt - Dlug`
3. ✅ Убрана неиспользуемая функция `_parse_netto_pln`
4. ✅ Исправлена фильтрация данных (убрана ссылка на `brak_data`)

## Результат
Теперь отчет о доходах работает правильно:
- **Fakt**: сумма заказов с датой реализации в текущем месяце
- **Dług**: сумма заказов со статусом 140 (долг)
- **Brak**: правильно рассчитывается как `Plan - Fakt - Dług`

## Тестирование
- ✅ Импорт модуля работает без ошибок
- ✅ Логика расчета восстановлена
- ✅ SQL-запросы исправлены

## Дата исправления
8 июля 2025 года
