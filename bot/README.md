# Planfix KPI Telegram Bot

Telegram –±–æ—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π –¥–∞–Ω–Ω—ã—Ö –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç—á–µ—Ç–æ–≤ —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—ã.

## –ö–æ–º–∞–Ω–¥—ã

### üìä –û—Ç—á–µ—Ç—ã

- `/report_all` - –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤—Å–µ –æ—Ç—á–µ—Ç—ã
- `/report_activity` - –û—Ç—á–µ—Ç –æ–± –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- `/report_kpi` - KPI –æ—Ç—á–µ—Ç
- `/report_bonus` - –û—Ç—á–µ—Ç –æ –ø—Ä–µ–º–∏—è—Ö (—Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü)
- `/report_bonus_previous` - –û—Ç—á–µ—Ç –æ –ø—Ä–µ–º–∏—è—Ö (–ø—Ä–µ–¥—ã–¥—É—â–∏–π –º–µ—Å—è—Ü)
- `/report_income` - –û—Ç—á–µ—Ç –æ –¥–æ—Ö–æ–¥–∞—Ö
- `/report_status` - –°—Ç–∞—Ç—É—Å –∫–ª–∏–µ–Ω—Ç–æ–≤

### üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

- `/sync_all` - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ Planfix
- `/sync_clients` - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –∫–ª–∏–µ–Ω—Ç–æ–≤
- `/sync_orders` - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –∑–∞–∫–∞–∑—ã
- `/sync_tasks` - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –∑–∞–¥–∞—á–∏

### ‚ÑπÔ∏è –ü–æ–º–æ—â—å

- `/start` –∏–ª–∏ `/help` - –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ–º–∞–Ω–¥

### –°—Ç–∞—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã (–¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)

- `/premia_current` - –æ—Ç—á–µ—Ç –ø–æ –ø—Ä–µ–º–∏–∏ –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü (alias –¥–ª—è `/report_bonus`)
- `/premia_previous` - –æ—Ç—á–µ—Ç –ø–æ –ø—Ä–µ–º–∏–∏ –∑–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏–π –º–µ—Å—è—Ü (alias –¥–ª—è `/report_bonus_previous`)

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ –∏–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ Render:

```bash
# GitHub Configuration
GITHUB_TOKEN=your_github_personal_access_token
GITHUB_REPO=krvzdrv/planfix_kpi

# Telegram Configuration
TELEGRAM_BOT_TOKEN=your_telegram_bot_token
```

### 2. GitHub Token

–°–æ–∑–¥–∞–π—Ç–µ Personal Access Token –≤ GitHub —Å –ø—Ä–∞–≤–∞–º–∏:
- `repo` - –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—é
- `workflow` - –¥–ª—è –∑–∞–ø—É—Å–∫–∞ GitHub Actions

### 3. Telegram Bot Token

–ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω –æ—Ç @BotFather –≤ Telegram.

### 4. Webhook

–ü–æ—Å–ª–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –Ω–∞ Render, –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ webhook –¥–ª—è –±–æ—Ç–∞:

```bash
python3 bot/setup_webhook.py
```

## –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ Render

1. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∫ Render
2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
   - `GITHUB_TOKEN`
   - `TELEGRAM_BOT_TOKEN`
3. Render –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑–≤–µ—Ä–Ω–µ—Ç webhook

## –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip3 install -r bot/requirements.txt

# –ó–∞–ø—É—Å–∫ webhook
python3 -m bot.wsgi

# Webhook –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ http://127.0.0.1:5001
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
bot/
‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îî‚îÄ‚îÄ telegram_webhook.py  # –û—Å–Ω–æ–≤–Ω–æ–π webhook endpoint
‚îú‚îÄ‚îÄ requirements.txt          # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è –±–æ—Ç–∞
‚îú‚îÄ‚îÄ wsgi.py                  # WSGI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è Render
‚îú‚îÄ‚îÄ setup_webhook.py         # –°–∫—Ä–∏–ø—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ webhook
‚îî‚îÄ‚îÄ README.md               # –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

## Troubleshooting

### Webhook –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ Render —Ä–∞–∑–≤–µ—Ä–Ω—É–ª —Å–µ—Ä–≤–∏—Å
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ Render

### –ö–æ–º–∞–Ω–¥—ã –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ webhook –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ Telegram
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ GitHub Actions workflow —Ä–∞–±–æ—Ç–∞–µ—Ç
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ GitHub Actions
