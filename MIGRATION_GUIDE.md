# Руководство по миграции экспорта аналитики

Этот документ описывает процесс выноса функционала экспорта аналитики из репозитория `planfix_kpi` в отдельный репозиторий `planfix_analytics`.

## Что было вынесено

### Файлы, перенесенные в новый репозиторий:

1. **Скрипты экспорта аналитики:**
   - `scripts/planfix_get_analytics_list.py` - получение списка аналитик
   - `scripts/planfix_export_analytics.py` - экспорт данных аналитик
   - `scripts/planfix_utils.py` - утилиты для работы с Planfix API

2. **Конфигурационные файлы:**
   - `requirements.txt` - зависимости Python
   - `env.example` - пример переменных окружения
   - `.gitignore` - игнорируемые файлы

3. **Документация:**
   - `README.md` - основная документация проекта
   - `ANALYTICS_EXPORT_README.md` - детальная документация по экспорту

4. **Автоматизация:**
   - `.github/workflows/analytics-export.yml` - GitHub Actions для автоматического экспорта

## Структура нового репозитория

```
planfix_analytics/
├── README.md                 # Документация проекта
├── ANALYTICS_EXPORT_README.md # Детальная документация
├── requirements.txt          # Зависимости Python
├── env.example              # Пример файла окружения
├── .gitignore               # Игнорируемые файлы
├── scripts/
│   ├── __init__.py
│   ├── planfix_utils.py     # Утилиты для работы с Planfix API
│   ├── planfix_get_analytics_list.py  # Получение списка аналитик
│   └── planfix_export_analytics.py    # Экспорт данных аналитик
└── .github/
    └── workflows/
        └── analytics-export.yml  # GitHub Actions для автоматизации
```

## Что нужно сделать в старом репозитории

### 1. Удалить файлы, связанные с экспортом аналитики

Удалите следующие файлы из репозитория `planfix_kpi`:

```bash
# Удалить скрипты экспорта аналитики
rm scripts/planfix_get_analytics_list.py
rm scripts/planfix_export_analytics.py

# Удалить документацию
rm ANALYTICS_EXPORT_README.md
```

### 2. Обновить зависимости

Удалите из `requirements.txt` зависимости, которые больше не нужны в основном проекте:

```bash
# Проверьте, какие зависимости используются только для экспорта аналитики
# и удалите их из requirements.txt если они не используются в других частях проекта
```

### 3. Обновить документацию

Обновите `README.md` в основном репозитории, добавив ссылку на новый репозиторий:

```markdown
## Экспорт аналитики

Функционал экспорта аналитических данных из ПланФикса вынесен в отдельный репозиторий:
[planfix_analytics](https://github.com/your-username/planfix_analytics)

Для работы с экспортом аналитики перейдите в репозиторий `planfix_analytics`.
```

## Настройка нового репозитория

### 1. Создание репозитория на GitHub

1. Создайте новый репозиторий `planfix_analytics` на GitHub
2. Скопируйте все файлы из папки `planfix_analytics` в новый репозиторий

### 2. Настройка секретов

В настройках нового репозитория добавьте следующие секреты:

- `PLANFIX_API_KEY` - API ключ ПланФикса
- `PLANFIX_TOKEN` - токен пользователя ПланФикса
- `PLANFIX_ACCOUNT` - аккаунт ПланФикса
- `SUPABASE_HOST` - хост Supabase
- `SUPABASE_DB` - база данных Supabase
- `SUPABASE_USER` - пользователь Supabase
- `SUPABASE_PASSWORD` - пароль Supabase
- `SUPABASE_PORT` - порт Supabase

### 3. Настройка переменных окружения

1. Скопируйте `env.example` в `.env`
2. Заполните все необходимые переменные окружения

### 4. Настройка аналитик

1. Запустите скрипт получения списка аналитик:
   ```bash
   python scripts/planfix_get_analytics_list.py
   ```

2. Откройте файл `analytics_list.txt` и найдите нужные аналитики

3. Обновите список `ANALYTIC_KEYS` в файле `scripts/planfix_export_analytics.py`

## Преимущества разделения

### 1. Разделение ответственности
- `planfix_kpi` - фокус на KPI и отчетах
- `planfix_analytics` - фокус на экспорте аналитических данных

### 2. Независимое развитие
- Каждый репозиторий может развиваться независимо
- Разные команды могут работать над разными проектами

### 3. Упрощение развертывания
- Меньше зависимостей в каждом проекте
- Более простая настройка окружения

### 4. Лучшая организация кода
- Четкое разделение функционала
- Более понятная структура проектов

## Обратная совместимость

### Если нужно временно использовать старый функционал:

1. Скопируйте нужные файлы из нового репозитория в старый
2. Установите зависимости из `requirements.txt` нового репозитория
3. Настройте переменные окружения

### Для полного перехода:

1. Обновите все ссылки на экспорт аналитики
2. Обновите документацию
3. Уведомите команду о новом расположении функционала

## Поддержка

При возникновении вопросов:

1. Проверьте документацию в новом репозитории
2. Создайте Issue в соответствующем репозитории
3. Обратитесь к команде разработки

## Заключение

Разделение функционала экспорта аналитики в отдельный репозиторий позволит:

- Упростить основной проект `planfix_kpi`
- Создать специализированный инструмент для работы с аналитикой
- Обеспечить независимое развитие функционала
- Улучшить организацию кода и документации

Новый репозиторий `planfix_analytics` готов к использованию и содержит все необходимые компоненты для работы с экспортом аналитических данных из ПланФикса. 